# è‡ªåŠ¨æ›´æ–°åŠŸèƒ½è¯´æ˜
# WaveSpectra2Text æ•°æ®åŒæ­¥ç³»ç»Ÿ

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªæ™ºèƒ½çš„æ•°æ®è‡ªåŠ¨æ›´æ–°ç³»ç»Ÿï¼Œå½“æ‚¨æ›´æ–° `data/audio` ç›®å½•ä¸­çš„éŸ³é¢‘æ–‡ä»¶æˆ– `data/labels.csv` æ ‡ç­¾æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š

1. **æ£€æµ‹æ•°æ®å˜åŒ–**ï¼šç›‘æ§éŸ³é¢‘æ–‡ä»¶å’Œæ ‡ç­¾æ–‡ä»¶çš„å¢åˆ æ”¹
2. **æ›´æ–°è¯æ±‡è¡¨**ï¼šè‡ªåŠ¨å°†æ–°æ ‡ç­¾æ·»åŠ åˆ° `vocab.py` æ–‡ä»¶
3. **ç”Ÿæˆç‰¹å¾æ–‡ä»¶**ï¼šé¢„å¤„ç†æ–°éŸ³é¢‘ä¸ºé¢‘è°±ç‰¹å¾
4. **ç»´æŠ¤ç´¢å¼•**ï¼šæ›´æ–°ç‰¹å¾æ–‡ä»¶ç´¢å¼•ï¼Œä¿æŒæ•°æ®ä¸€è‡´æ€§

---

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•1ï¼šæ‰‹åŠ¨åŒæ­¥ï¼ˆæ¨èï¼‰

```bash
# ä¸€é”®åŒæ­¥æ‰€æœ‰æ•°æ®
python3 simple_auto_update.py

# æˆ–ä½¿ç”¨å®Œæ•´ç‰ˆï¼ˆéœ€è¦pandasï¼‰
python3 sync_data.py
```

**é€‚ç”¨åœºæ™¯**ï¼š
- æ·»åŠ äº†æ–°çš„éŸ³é¢‘æ–‡ä»¶
- ä¿®æ”¹äº†æ ‡ç­¾æ–‡ä»¶
- éœ€è¦ä¸€æ¬¡æ€§åŒæ­¥æ‰€æœ‰æ•°æ®

### æ–¹æ³•2ï¼šå®æ—¶ç›‘æ§

```bash
# å¯åŠ¨å®æ—¶ç›‘æ§ï¼ˆéœ€è¦pandasï¼‰
python3 watch_data_changes.py

# æˆ–ä½¿ç”¨å®Œæ•´ç‰ˆè‡ªåŠ¨æ›´æ–°ç³»ç»Ÿ
python3 auto_update_system.py --mode monitor
```

**é€‚ç”¨åœºæ™¯**ï¼š
- å¼€å‘é˜¶æ®µé¢‘ç¹ä¿®æ”¹æ•°æ®
- éœ€è¦å®æ—¶å“åº”æ•°æ®å˜åŒ–
- é•¿æœŸè¿è¡Œçš„æ•°æ®å¤„ç†æµæ°´çº¿

### æ–¹æ³•3ï¼šå¼ºåˆ¶é‡æ–°å¤„ç†

```bash
# å¼ºåˆ¶é‡æ–°å¤„ç†æ‰€æœ‰æ–‡ä»¶
python3 sync_data.py --force
```

**é€‚ç”¨åœºæ™¯**ï¼š
- æ•°æ®æ–‡ä»¶æŸåéœ€è¦é‡å»º
- æ›´æ”¹äº†é¢„å¤„ç†å‚æ•°
- éœ€è¦æ¸…ç†å¹¶é‡æ–°ç”Ÿæˆæ‰€æœ‰ç‰¹å¾

---

## ğŸ“ ç›‘æ§çš„æ–‡ä»¶å’Œç›®å½•

### è¾“å…¥ç›‘æ§
- `data/audio/` - éŸ³é¢‘æ–‡ä»¶ç›®å½•
  - æ”¯æŒæ ¼å¼ï¼š`.wav`, `.mp3`, `.flac`, `.m4a`, `.aac`, `.ogg`
  - è‡ªåŠ¨æ£€æµ‹ï¼šæ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤
- `data/labels.csv` - æ ‡ç­¾æ–‡ä»¶
  - æ ¼å¼ï¼š`filename,label`
  - è‡ªåŠ¨æ£€æµ‹ï¼šå†…å®¹å˜åŒ–ã€æ–°æ ‡ç­¾

### è‡ªåŠ¨æ›´æ–°çš„æ–‡ä»¶
- `vocab.py` - è¯æ±‡è¡¨æ–‡ä»¶
  - è‡ªåŠ¨æ·»åŠ æ–°æ ‡ç­¾åˆ°è¯æ±‡æ˜ å°„
  - ä¿æŒç´¢å¼•è¿ç»­æ€§
  - è‡ªåŠ¨å¤‡ä»½åŸæ–‡ä»¶
- `data/features/` - ç‰¹å¾æ–‡ä»¶ç›®å½•
  - è‡ªåŠ¨ç”Ÿæˆ `.npy` ç‰¹å¾æ–‡ä»¶
  - è‡ªåŠ¨åˆ›å»º `spectrum_index.csv` ç´¢å¼•
  - è‡ªåŠ¨æ¸…ç†åˆ é™¤æ–‡ä»¶å¯¹åº”çš„ç‰¹å¾

---

## ğŸ”„ å·¥ä½œæµç¨‹

### 1. æ•°æ®å˜åŒ–æ£€æµ‹
```
éŸ³é¢‘æ–‡ä»¶å˜åŒ– â†’ è®¡ç®—æ–‡ä»¶å“ˆå¸Œ â†’ è¯†åˆ«æ–°å¢/ä¿®æ”¹/åˆ é™¤
æ ‡ç­¾æ–‡ä»¶å˜åŒ– â†’ è§£æCSVå†…å®¹ â†’ æå–æ–°æ ‡ç­¾
```

### 2. è¯æ±‡è¡¨æ›´æ–°
```
æå–æ–°æ ‡ç­¾ â†’ æ£€æŸ¥è¯æ±‡è¡¨ â†’ æ·»åŠ æ–°æ˜ å°„ â†’ å¤‡ä»½åŸæ–‡ä»¶ â†’ æ›´æ–°vocab.py
```

### 3. ç‰¹å¾ç”Ÿæˆ
```
æ–°éŸ³é¢‘æ–‡ä»¶ â†’ STFTé¢‘è°±æå– â†’ ä¿å­˜.npyæ–‡ä»¶ â†’ æ›´æ–°ç´¢å¼•æ–‡ä»¶
```

### 4. æ•°æ®æ¸…ç†
```
åˆ é™¤çš„éŸ³é¢‘ â†’ åˆ é™¤å¯¹åº”ç‰¹å¾ â†’ æ›´æ–°ç´¢å¼• â†’ æ¸…ç†ç¼“å­˜
```

---

## ğŸ“Š ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šæ·»åŠ æ–°éŸ³é¢‘æ–‡ä»¶

```bash
# 1. å°†æ–°éŸ³é¢‘æ–‡ä»¶æ”¾å…¥data/audio/ç›®å½•
cp new_audio.wav data/audio/

# 2. æ›´æ–°æ ‡ç­¾æ–‡ä»¶
echo "new_audio.wav,æ–°æ ‡ç­¾" >> data/labels.csv

# 3. è¿è¡Œè‡ªåŠ¨åŒæ­¥
python3 simple_auto_update.py
```

**é¢„æœŸè¾“å‡º**ï¼š
```
ğŸ” æ£€æŸ¥æ•°æ®æ›´æ–°...
ğŸ“ å‘ç° 11 ä¸ªéŸ³é¢‘æ–‡ä»¶
ğŸ·ï¸  å‘ç°æ ‡ç­¾: ['ä¸€', 'äºŒ', 'ä¸‰', ..., 'æ–°æ ‡ç­¾']
ğŸ†• éœ€è¦æ·»åŠ çš„æ–°æ ‡ç­¾: ['æ–°æ ‡ç­¾']
âœ… è¯æ±‡è¡¨å·²æ›´æ–°ï¼Œæ·»åŠ æ ‡ç­¾: {'æ–°æ ‡ç­¾'}
ğŸ“ å¤‡ä»½æ–‡ä»¶: vocab.py.backup
```

### ç¤ºä¾‹2ï¼šæ‰¹é‡æ·»åŠ æ•°æ®

```bash
# 1. æ‰¹é‡å¤åˆ¶éŸ³é¢‘æ–‡ä»¶
cp batch_audio/*.wav data/audio/

# 2. æ‰¹é‡æ›´æ–°æ ‡ç­¾æ–‡ä»¶ï¼ˆä½¿ç”¨è„šæœ¬æˆ–æ‰‹åŠ¨ç¼–è¾‘ï¼‰
python3 setup_data.py  # è‡ªåŠ¨ç”Ÿæˆæ ‡ç­¾æ¨¡æ¿

# 3. è¿è¡ŒåŒæ­¥
python3 simple_auto_update.py
```

### ç¤ºä¾‹3ï¼šå®æ—¶ç›‘æ§æ¨¡å¼

```bash
# å¯åŠ¨ç›‘æ§
python3 watch_data_changes.py

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯æ·»åŠ æ–‡ä»¶
cp new_file.wav data/audio/
echo "new_file.wav,æµ‹è¯•" >> data/labels.csv

# ç›‘æ§ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶å¤„ç†
```

---

## âš™ï¸ é…ç½®é€‰é¡¹

### è‡ªåŠ¨æ›´æ–°ç³»ç»Ÿé…ç½®

```python
# åœ¨auto_update_system.pyä¸­å¯é…ç½®ï¼š
AutoUpdateSystem(
    audio_dir='data/audio',        # éŸ³é¢‘ç›®å½•
    labels_file='data/labels.csv', # æ ‡ç­¾æ–‡ä»¶
    features_dir='data/features',  # ç‰¹å¾ç›®å½•
    vocab_file='vocab.py',         # è¯æ±‡è¡¨æ–‡ä»¶
    log_file='auto_update.log'     # æ—¥å¿—æ–‡ä»¶
)
```

### ç›‘æ§é—´éš”è®¾ç½®

```bash
# è®¾ç½®æ£€æŸ¥é—´éš”ä¸º30ç§’
python3 auto_update_system.py --mode monitor --interval 30
```

---

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. è¯æ±‡è¡¨æ›´æ–°å¤±è´¥
```bash
âŒ æ›´æ–°è¯æ±‡è¡¨å¤±è´¥: æœªæ‰¾åˆ°è¯æ±‡è¡¨å®šä¹‰
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `vocab.py` æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
- ç¡®ä¿åŒ…å« `self.word_to_idx = {` å®šä¹‰
- æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶ `vocab.py.backup`

#### 2. æ ‡ç­¾æ–‡ä»¶æ ¼å¼é”™è¯¯
```bash
âŒ è¯»å–æ ‡ç­¾æ–‡ä»¶å¤±è´¥: 'label' column not found
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿CSVæ–‡ä»¶åŒ…å« `filename` å’Œ `label` åˆ—
- æ£€æŸ¥æ–‡ä»¶ç¼–ç ä¸ºUTF-8
- è¿è¡Œ `python3 setup_data.py` é‡æ–°ç”Ÿæˆ

#### 3. éŸ³é¢‘æ–‡ä»¶å¤„ç†å¤±è´¥
```bash
âŒ å¤„ç†æ–‡ä»¶ test.wav å¤±è´¥: No module named 'librosa'
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
pip install librosa soundfile
```

### è°ƒè¯•æŠ€å·§

#### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
```bash
# æŸ¥çœ‹è‡ªåŠ¨æ›´æ–°æ—¥å¿—
tail -f auto_update.log

# è¿è¡Œæµ‹è¯•è„šæœ¬
python3 test_auto_update.py
```

#### æ‰‹åŠ¨éªŒè¯
```bash
# æ£€æŸ¥è¯æ±‡è¡¨å†…å®¹
python3 -c "from vocab import vocab; print(vocab.word_to_idx)"

# æ£€æŸ¥æ ‡ç­¾æ–‡ä»¶
head -10 data/labels.csv

# æ£€æŸ¥ç‰¹å¾æ–‡ä»¶
ls -la data/features/
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### å¤§æ•°æ®é›†ä¼˜åŒ–

1. **ä½¿ç”¨é¢„è®¡ç®—æ¨¡å¼**ï¼š
```bash
# ä¸€æ¬¡æ€§é¢„å¤„ç†æ‰€æœ‰éŸ³é¢‘
python3 batch_preprocess.py --audio_dir data/audio --output_dir data/features

# ä½¿ç”¨é¢„è®¡ç®—ç‰¹å¾è®­ç»ƒï¼ˆé€Ÿåº¦æå‡5-10å€ï¼‰
python3 train_scale_1.py --use_precomputed
```

2. **æ‰¹é‡å¤„ç†**ï¼š
```bash
# æ‰¹é‡æ·»åŠ æ–‡ä»¶åå†åŒæ­¥
cp batch/*.wav data/audio/
python3 simple_auto_update.py  # ä¸€æ¬¡æ€§å¤„ç†æ‰€æœ‰å˜åŒ–
```

3. **ç¼“å­˜ä¼˜åŒ–**ï¼š
- ç³»ç»Ÿè‡ªåŠ¨ç¼“å­˜å·²å¤„ç†çš„ç‰¹å¾æ–‡ä»¶
- åªæœ‰æ–‡ä»¶å˜åŒ–æ—¶æ‰é‡æ–°å¤„ç†
- æ”¯æŒå¢é‡æ›´æ–°

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

### ä½¿ç”¨å‰æ£€æŸ¥
- [ ] éŸ³é¢‘æ–‡ä»¶å·²æ”¾ç½®åœ¨ `data/audio/` ç›®å½•
- [ ] æ ‡ç­¾æ–‡ä»¶ `data/labels.csv` æ ¼å¼æ­£ç¡®
- [ ] å·²å®‰è£…å¿…è¦ä¾èµ–ï¼š`librosa`, `numpy`
- [ ] `vocab.py` æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®

### ä½¿ç”¨åéªŒè¯
- [ ] æ–°æ ‡ç­¾å·²æ·»åŠ åˆ° `vocab.py`
- [ ] ç‰¹å¾æ–‡ä»¶å·²ç”Ÿæˆåœ¨ `data/features/`
- [ ] ç´¢å¼•æ–‡ä»¶ `spectrum_index.csv` å·²æ›´æ–°
- [ ] å¤‡ä»½æ–‡ä»¶å·²åˆ›å»ºï¼ˆå¦‚æœ‰æ›´æ–°ï¼‰

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æ•°æ®ç®¡ç†
- å®šæœŸå¤‡ä»½é‡è¦æ–‡ä»¶
- ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç®¡ç†é…ç½®æ–‡ä»¶
- ä¿æŒéŸ³é¢‘æ–‡ä»¶å‘½åè§„èŒƒ

### 2. å¼€å‘æµç¨‹
```bash
# æ¨èçš„å¼€å‘æµç¨‹
1. æ·»åŠ æ–°éŸ³é¢‘æ–‡ä»¶åˆ° data/audio/
2. æ›´æ–° data/labels.csv
3. è¿è¡Œ python3 simple_auto_update.py
4. éªŒè¯æ›´æ–°ç»“æœ
5. å¼€å§‹è®­ç»ƒæˆ–æ¨ç†
```

### 3. ç”Ÿäº§ç¯å¢ƒ
- ä½¿ç”¨å®æ—¶ç›‘æ§æ¨¡å¼
- è®¾ç½®åˆé€‚çš„æ£€æŸ¥é—´éš”
- é…ç½®æ—¥å¿—æ–‡ä»¶ç›‘æ§
- å®šæœŸæ¸…ç†ç¼“å­˜æ–‡ä»¶

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è·å–å¸®åŠ©
```bash
# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
python3 simple_auto_update.py --help
python3 auto_update_system.py --help

# è¿è¡Œæµ‹è¯•
python3 test_auto_update.py
python3 test_new_label.py
```

### åŠŸèƒ½éªŒè¯
- æ‰€æœ‰è‡ªåŠ¨æ›´æ–°åŠŸèƒ½éƒ½ç»è¿‡æµ‹è¯•éªŒè¯
- æ”¯æŒå¢é‡æ›´æ–°å’Œå…¨é‡é‡å»º
- å…¼å®¹ç°æœ‰çš„è®­ç»ƒå’Œæ¨ç†æµç¨‹
- æä¾›å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œå›æ»šæœºåˆ¶

---

*æœ¬è‡ªåŠ¨æ›´æ–°ç³»ç»Ÿä¸ºWaveSpectra2Texté¡¹ç›®æä¾›äº†å®Œæ•´çš„æ•°æ®ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œç¡®ä¿æ•°æ®å˜åŒ–æ—¶ç›¸å…³æ–‡ä»¶çš„è‡ªåŠ¨åŒæ­¥ï¼Œå¤§å¤§æå‡äº†å¼€å‘å’Œä½¿ç”¨æ•ˆç‡ã€‚*